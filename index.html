<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Projects | Graphic Era University</title>
    <!-- Link to the external CSS file -->
    <link rel="stylesheet" href="styles.css">
    <!-- Link to Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <!-- Meta tags for responsiveness -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

    <!-- Navigation Bar -->
    <nav>
        <div class="nav-container">
            <img src="Graphic.jpeg" alt="Graphic Era University Logo" class="logo">
            <ul class="nav-links">
                <li><a href="#home" class="active">Home</a></li>
                <li><a href="#courses">Projects</a></li>
                <li><a href="#gallery">Gallery</a></li>
                <li><a href="#testimonials">Testimonials</a></li>
                <li><a href="#about">About GEU</a></li>
                <li><a href="#contact">Contact</a></li>
                <li><a href="#admin">Admin Panel</a></li>
            </ul>
            <div class="menu-toggle">
                <i class="fas fa-bars"></i>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="home" class="hero-section">
        <div class="overlay"></div> <!-- Overlay for better text readability -->
        <div class="hero-content">
            <h1>Welcome to Graphic Era University Student Projects</h1>
            <p>Explore innovative projects by our talented students.</p>
            <a href="#courses" class="button">Get Started</a>
        </div>
    </section>

    <!-- Courses Section -->
    <section id="courses" class="courses-section">
        <div class="container">
            <!-- Course Selection Dropdown -->
            <div class="course-selection">
                <label for="courseDropdown">Select a Course:</label>
                <select id="courseDropdown">
                    <option value="" disabled selected>Select a course</option>
                    <option value="btech">B.Tech</option>
                    <option value="bca">BCA</option>
                    <option value="bba">BBA</option>
                    <!-- Add more courses as needed -->
                </select>
            </div>

            <!-- Course Sections (Hidden by default) -->
            <!-- B.Tech Course Section -->
            <div class="course-section" data-course="btech" style="display: none;">
                <!-- Course title -->
                <h2>Bachelor of Technology (B.Tech)</h2>

                <!-- Search Bar -->
                <div class="search-bar">
                    <input type="text" placeholder="Search by any field" class="search-input">
                </div>

                <!-- Project table -->
                <div class="table-responsive">
                    <table aria-label="B.Tech Projects">
                        <thead>
                            <tr>
                                <!-- Table headers -->
                                <th data-column="student-id">Student ID</th>
                                <th data-column="university-id">University ID</th>
                                <th data-column="name">Name</th>
                                <th data-column="project-title">Project Title</th>
                                <th data-column="project-link">Project Link</th>
                                <th data-column="working-code">Working Code</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dynamic entries for B.Tech -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- BCA Course Section -->
            <div class="course-section" data-course="bca" style="display: none;">
                <h2>Bachelor of Computer Applications (BCA)</h2>

                <!-- Search Bar -->
                <div class="search-bar">
                    <input type="text" placeholder="Search by any field" class="search-input">
                </div>

                <!-- Project table -->
                <div class="table-responsive">
                    <table aria-label="BCA Projects">
                        <thead>
                            <tr>
                                <!-- Table headers -->
                                <th data-column="student-id">Student ID</th>
                                <th data-column="university-id">University ID</th>
                                <th data-column="name">Name</th>
                                <th data-column="project-title">Project Title</th>
                                <th data-column="project-link">Project Link</th>
                                <th data-column="working-code">Working Code</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dynamic entries for BCA -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- BBA Course Section -->
            <div class="course-section" data-course="bba" style="display: none;">
                <h2>Bachelor of Business Administration (BBA)</h2>

                <!-- Search Bar -->
                <div class="search-bar">
                    <input type="text" placeholder="Search by any field" class="search-input">
                </div>

                <!-- Project table -->
                <div class="table-responsive">
                    <table aria-label="BBA Projects">
                        <thead>
                            <tr>
                                <!-- Table headers -->
                                <th data-column="student-id">Student ID</th>
                                <th data-column="university-id">University ID</th>
                                <th data-column="name">Name</th>
                                <th data-column="project-title">Project Title</th>
                                <th data-column="project-link">Project Link</th>
                                <th data-column="working-code">Working Code</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dynamic entries for BBA -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <!-- Gallery Section -->
    <section id="gallery" class="gallery-section">
        <div class="container">
            <h2>Campus Gallery</h2>
            <div class="gallery-grid">
                <!-- Gallery Images -->
                <div class="gallery-item">
                    <img src="campus1.jpeg" alt="Campus Image 1">
                </div>
                <div class="gallery-item">
                    <img src="campus2.jpeg" alt="Campus Image 2">
                </div>
                <div class="gallery-item">
                    <img src="campus3.jpeg" alt="Campus Image 3">
                </div>
                <div class="gallery-item">
                    <img src="campus4.jpeg" alt="Campus Image 4">
                </div>
                <!-- Add more gallery items as needed -->
            </div>
        </div>
    </section>

    <!-- Testimonials Section -->
    <section id="testimonials" class="testimonials-section">
        <div class="container">
            <h2>What Our Students Say</h2>
            <div class="testimonial-slider">
                <div class="testimonial">
                    <p>"Graphic Era University provided me with the resources and support needed to excel in my project. The faculty was always available to guide me."</p>
                    <h3>- John Doe</h3>
                </div>
                <div class="testimonial">
                    <p>"Working on my BCA project was a transformative experience. The collaborative environment fostered innovation and creativity."</p>
                    <h3>- Jane Smith</h3>
                </div>
                <div class="testimonial">
                    <p>"The hands-on approach at GEU allowed me to apply theoretical knowledge to real-world projects, preparing me for my career."</p>
                    <h3>- Michael Brown</h3>
                </div>
                <!-- Add more testimonials as needed -->
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="about-section">
        <div class="container">
            <h2>About Graphic Era University</h2>
            <p>Graphic Era University is committed to excellence in education and fostering innovation among students. Our project showcase highlights the talent and hard work of our students across various disciplines.</p>
            <a href="https://geu.ac.in/" target="_blank" class="button">Visit Our Official Website</a>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="contact-section">
        <div class="container">
            <h2>Contact Us</h2>
            <p>If you have any questions or need assistance, feel free to reach out to us.</p>
            <p>Email: <a href="mailto:info@geu.ac.in">info@geu.ac.in</a></p>
            <p>Phone: +91-135-2643420</p>
            <p>Address: 566/6 Bell Road, Clement Town, Dehradun, Uttarakhand, India</p>
        </div>
    </section>

    <!-- Admin Panel Section -->
    <section id="admin" class="admin-section">
        <div class="container">
            <h2>Admin Panel</h2>
            <!-- Admin Login Form -->
            <div class="admin-login">
                <form id="adminLoginForm">
                    <label for="adminUsername">Username:</label>
                    <input type="text" id="adminUsername" name="adminUsername" required>
                    <label for="adminPassword">Password:</label>
                    <input type="password" id="adminPassword" name="adminPassword" required>
                    <button type="submit" class="button">Login</button>
                </form>
            </div>
            <!-- Admin Dashboard (Hidden by default) -->
            <div class="admin-dashboard" style="display: none;">
                <h3>Welcome, Aditya</h3>
                <p>Select a course to manage projects:</p>
                <select id="adminCourseDropdown">
                    <option value="" disabled selected>Select a course</option>
                    <option value="btech">B.Tech</option>
                    <option value="bca">BCA</option>
                    <option value="bba">BBA</option>
                </select>
                <!-- Add New Project Button -->
                <div class="add-new-project">
                    <button class="button add-new-project-button">Add New Project</button>
                </div>
                <div class="admin-table-responsive">
                    <table id="adminProjectTable">
                        <thead>
                            <tr>
                                <!-- Table headers -->
                                <th>Student ID</th>
                                <th>University ID</th>
                                <th>Name</th>
                                <th>Project Title</th>
                                <th>Project Link</th>
                                <th>Working Code</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dynamic entries for Admin Panel -->
                        </tbody>
                    </table>
                </div>
                <button class="button" id="adminLogoutButton">Logout</button>
            </div>
        </div>
    </section>

    <!-- Footer Section -->
    <footer>
        <div class="footer-container">
            <p>&copy; 2023 Graphic Era University. All rights reserved.</p>
            <div class="social-icons">
                <a href="https://www.facebook.com/geuofficial/" target="_blank"><i class="fab fa-facebook-f"></i></a>
                <a href="https://twitter.com/geuofficial" target="_blank"><i class="fab fa-twitter"></i></a>
                <a href="https://www.linkedin.com/school/graphic-era-university/" target="_blank"><i class="fab fa-linkedin-in"></i></a>
                <a href="https://www.instagram.com/graphic_era_university/" target="_blank"><i class="fab fa-instagram"></i></a>
            </div>
        </div>
    </footer>

    <!-- Modal Structure for Student Details -->
    <div id="studentModal" class="modal" aria-hidden="true" role="dialog">
        <div class="modal-content">
            <button class="close-button" aria-label="Close">&times;</button>
            <h2 id="modalStudentName"></h2>
            <p><strong>Student ID:</strong> <span id="modalStudentID"></span></p>
            <p><strong>University ID:</strong> <span id="modalUniversityID"></span></p>
            <p><strong>Project Title:</strong> <span id="modalProjectTitle"></span></p>
            <p><strong>Project Link:</strong> <a href="#" id="modalProjectLink" target="_blank">View Project</a></p>
            <p><strong>Working Code:</strong> <a href="#" id="modalWorkingCode" target="_blank">Live Demo</a></p>
        </div>
    </div>

    <!-- Modal Structure for Adding New Project -->
    <div id="addProjectModal" class="modal" aria-hidden="true" role="dialog">
        <div class="modal-content">
            <button class="close-button" aria-label="Close">&times;</button>
            <h2>Add New Project</h2>
            <form id="addProjectForm">
                <label for="projectCourse">Course:</label>
                <select id="projectCourse" name="projectCourse" required>
                    <option value="" disabled selected>Select a course</option>
                    <option value="btech">B.Tech</option>
                    <option value="bca">BCA</option>
                    <option value="bba">BBA</option>
                </select>

                <label for="projectStudentID">Student ID:</label>
                <input type="text" id="projectStudentID" name="projectStudentID" required>

                <label for="projectUniversityID">University ID:</label>
                <input type="text" id="projectUniversityID" name="projectUniversityID" required>

                <label for="projectName">Name:</label>
                <input type="text" id="projectName" name="projectName" required>

                <label for="projectTitle">Project Title:</label>
                <input type="text" id="projectTitle" name="projectTitle" required>

                <label for="projectLink">Project Link (GitHub):</label>
                <input type="url" id="projectLink" name="projectLink" required>

                <label for="workingCode">Working Code (Live Demo):</label>
                <input type="url" id="workingCode" name="workingCode" required>

                <button type="submit" class="button">Submit</button>
            </form>
        </div>
    </div>

    <!-- Scroll to Top Button -->
    <button id="scrollTopBtn" title="Go to top" aria-label="Scroll to top"><i class="fas fa-chevron-up"></i></button>

    <!-- JavaScript Code -->
    <script>
        // Wait until the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Google Sheets API Configuration
            const apiKey = 'AIzaSyBNjapPXX0wFnlNYSbbMzXKoQqauHxymOI'; // <-- Correctly formatted API key
            const spreadsheetId = '1YW1DXpGzs_RJWAi5C_J98YS8nlb5tpLiNkq2qvknyCs';
            const sheetName = 'Form Responses 1'; // <-- Ensure this matches your sheet name

            // DOM Elements
            const courseDropdown = document.getElementById('courseDropdown');
            const courseSections = document.querySelectorAll('.course-section');
            const menuToggle = document.querySelector('.menu-toggle');
            const navLinks = document.querySelector('.nav-links');
            const scrollTopBtn = document.getElementById('scrollTopBtn');
            const adminLoginForm = document.getElementById('adminLoginForm');
            const adminDashboard = document.querySelector('.admin-dashboard');
            const adminCourseDropdown = document.getElementById('adminCourseDropdown');
            const adminProjectTable = document.getElementById('adminProjectTable').getElementsByTagName('tbody')[0];
            const adminLogoutButton = document.getElementById('adminLogoutButton');
            const addNewProjectButton = document.querySelector('.add-new-project-button');
            const addProjectModal = document.getElementById('addProjectModal');
            const addProjectForm = document.getElementById('addProjectForm');
            let currentCourse = '';
            let isAdminLoggedIn = false;

            // Initialize Data
            let projectsData = []; // Array to hold all projects

            // Load Projects from Google Sheets and Local Storage
            async function loadProjects() {
                const sheetProjects = await fetchProjectData();
                const localProjects = getLocalProjects();
                projectsData = [...sheetProjects, ...localProjects];
                populateAllCourseTables();
            }

            // Fetch Projects from Google Sheets
            async function fetchProjectData() {
                const endpoint = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${encodeURIComponent(sheetName)}!A:G?key=${apiKey}`;
                
                try {
                    const response = await fetch(endpoint);
                    const data = await response.json();

                    if (!data.values || data.values.length === 0) {
                        console.log('No data found in Google Sheets.');
                        return [];
                    }

                    // Assuming first row is headers
                    const rows = data.values.slice(1);
                    const projects = rows.map(row => ({
                        studentID: row[0],
                        universityID: row[1],
                        name: row[2],
                        course: row[3].toLowerCase(),
                        projectTitle: row[4],
                        projectLink: row[5],
                        workingCode: row[6]
                    }));

                    return projects;
                } catch (error) {
                    console.error('Error fetching data from Google Sheets:', error);
                    return [];
                }
            }

            // Get Projects from Local Storage
            function getLocalProjects() {
                const localData = localStorage.getItem('localProjects');
                return localData ? JSON.parse(localData) : [];
            }

            // Save Projects to Local Storage
            function saveLocalProjects() {
                const localProjects = projectsData.filter(p => p.isLocal);
                localStorage.setItem('localProjects', JSON.stringify(localProjects));
            }

            // Populate All Course Tables
            function populateAllCourseTables() {
                courseSections.forEach(section => {
                    const course = section.getAttribute('data-course');
                    const tbody = section.querySelector('tbody');
                    tbody.innerHTML = ''; // Clear existing rows

                    const filteredProjects = projectsData.filter(p => p.course === course.toLowerCase());

                    filteredProjects.forEach(project => {
                        const row = document.createElement('tr');

                        row.innerHTML = `
                            <td>${project.studentID}</td>
                            <td>${project.universityID}</td>
                            <td><a href="#" class="student-name">${project.name}</a></td>
                            <td>${project.projectTitle}</td>
                            <td><a href="${project.projectLink}" target="_blank">Project Link</a></td>
                            <td><a href="${project.workingCode}" target="_blank">Live Demo</a></td>
                        `;

                        tbody.appendChild(row);
                    });
                });
            }

            // Mobile Navigation Toggle
            menuToggle.addEventListener('click', function() {
                navLinks.classList.toggle('nav-active');
                menuToggle.classList.toggle('toggle');
            });

            // Scroll to Top Button
            window.addEventListener('scroll', function() {
                if (window.pageYOffset > 300) {
                    scrollTopBtn.style.display = 'block';
                } else {
                    scrollTopBtn.style.display = 'none';
                }
            });

            scrollTopBtn.addEventListener('click', function() {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            // Event Listener for Course Selection
            courseDropdown.addEventListener('change', function() {
                var selectedCourse = this.value;
                currentCourse = selectedCourse;

                // Hide all course sections
                courseSections.forEach(function(section) {
                    section.style.display = 'none';
                });

                // Show the selected course section
                var selectedSection = document.querySelector('.course-section[data-course="' + selectedCourse + '"]');
                if (selectedSection) {
                    selectedSection.style.display = 'block';

                    // Initialize functionalities
                    initializeSearch(selectedSection);
                    initializeSorting(selectedSection);
                    initializeModal(selectedSection);
                }
            });

            // Initialize Search Functionality
            function initializeSearch(section) {
                var searchInput = section.querySelector('.search-input');
                var tableRows = section.querySelectorAll('tbody tr');

                searchInput.addEventListener('keyup', function() {
                    var filter = this.value.toLowerCase();
                    tableRows.forEach(function(row) {
                        var cells = row.getElementsByTagName('td');
                        var match = false;
                        for (var i = 0; i < cells.length; i++) {
                            if (cells[i].textContent.toLowerCase().includes(filter)) {
                                match = true;
                                break;
                            }
                        }
                        row.style.display = match ? '' : 'none';
                    });
                });
            }

            // Initialize Sorting Functionality
            function initializeSorting(section) {
                var headers = section.querySelectorAll('th[data-column]');
                headers.forEach(function(header) {
                    header.style.cursor = 'pointer'; // Indicate sortable
                    header.addEventListener('click', function() {
                        var table = section.querySelector('table');
                        var tbody = table.querySelector('tbody');
                        var rows = Array.from(tbody.querySelectorAll('tr'));
                        var columnIndex = Array.from(header.parentNode.children).indexOf(header);
                        var ascending = header.classList.toggle('ascending');

                        rows.sort(function(a, b) {
                            var cellA = a.cells[columnIndex].textContent.trim().toLowerCase();
                            var cellB = b.cells[columnIndex].textContent.trim().toLowerCase();

                            if (cellA < cellB) {
                                return ascending ? -1 : 1;
                            }
                            if (cellA > cellB) {
                                return ascending ? 1 : -1;
                            }
                            return 0;
                        });

                        // Remove existing rows
                        while (tbody.firstChild) {
                            tbody.removeChild(tbody.firstChild);
                        }

                        // Append sorted rows
                        rows.forEach(function(row) {
                            tbody.appendChild(row);
                        });
                    });
                });
            }

            // Initialize Modal Functionality for Student Details
            function initializeModal(section) {
                var modal = document.getElementById('studentModal');
                var closeButton = modal.querySelector('.close-button');
                var studentNames = section.querySelectorAll('.student-name');

                studentNames.forEach(function(nameLink) {
                    nameLink.addEventListener('click', function(event) {
                        event.preventDefault();
                        var row = this.closest('tr');
                        var studentID = row.cells[0].textContent.trim();
                        var universityID = row.cells[1].textContent.trim();
                        var name = row.cells[2].textContent.trim();
                        var projectTitle = row.cells[3].textContent.trim();
                        var projectLink = row.cells[4].querySelector('a').href;
                        var workingCode = row.cells[5].querySelector('a').href;

                        document.getElementById('modalStudentName').textContent = name;
                        document.getElementById('modalStudentID').textContent = studentID;
                        document.getElementById('modalUniversityID').textContent = universityID;
                        document.getElementById('modalProjectTitle').textContent = projectTitle;
                        document.getElementById('modalProjectLink').href = projectLink;
                        document.getElementById('modalWorkingCode').href = workingCode;

                        modal.style.display = 'block';
                        modal.setAttribute('aria-hidden', 'false');
                    });
                });

                closeButton.addEventListener('click', function() {
                    modal.style.display = 'none';
                    modal.setAttribute('aria-hidden', 'true');
                });

                window.addEventListener('click', function(event) {
                    if (event.target == modal) {
                        modal.style.display = 'none';
                        modal.setAttribute('aria-hidden', 'true');
                    }
                });
            }

            // Admin Panel Functionality
            adminLoginForm.addEventListener('submit', function(event) {
                event.preventDefault();

                // Get login credentials
                var username = document.getElementById('adminUsername').value.trim();
                var password = document.getElementById('adminPassword').value.trim();

                // Authentication check
                if (username === 'Aditya' && password === 'admin321') {
                    isAdminLoggedIn = true;
                    adminLoginForm.style.display = 'none';
                    adminDashboard.style.display = 'block';
                    // Enable Add New Project Button
                    addNewProjectButton.style.display = 'block';
                } else {
                    alert('Invalid credentials. Please try again.');
                }
            });

            adminLogoutButton.addEventListener('click', function() {
                isAdminLoggedIn = false;
                adminDashboard.style.display = 'none';
                adminLoginForm.style.display = 'block';
                adminLoginForm.reset();
                // Disable Add New Project Button
                addNewProjectButton.style.display = 'none';
            });

            // Add New Project Button Functionality
            addNewProjectButton.addEventListener('click', function() {
                addProjectModal.style.display = 'block';
                addProjectModal.setAttribute('aria-hidden', 'false');
            });

            // Close Add Project Modal
            var addProjectCloseButton = addProjectModal.querySelector('.close-button');
            addProjectCloseButton.addEventListener('click', function() {
                addProjectModal.style.display = 'none';
                addProjectModal.setAttribute('aria-hidden', 'true');
                addProjectForm.reset();
            });

            window.addEventListener('click', function(event) {
                if (event.target == addProjectModal) {
                    addProjectModal.style.display = 'none';
                    addProjectModal.setAttribute('aria-hidden', 'true');
                    addProjectForm.reset();
                }
            });

            // Handle Add Project Form Submission
            addProjectForm.addEventListener('submit', function(event) {
                event.preventDefault();

                // Get form data
                var projectCourse = document.getElementById('projectCourse').value.trim().toLowerCase();
                var studentID = document.getElementById('projectStudentID').value.trim();
                var universityID = document.getElementById('projectUniversityID').value.trim();
                var name = document.getElementById('projectName').value.trim();
                var projectTitle = document.getElementById('projectTitle').value.trim();
                var projectLink = document.getElementById('projectLink').value.trim();
                var workingCode = document.getElementById('workingCode').value.trim();

                // Validation
                if (!projectCourse || !studentID || !universityID || !name || !projectTitle || !projectLink || !workingCode) {
                    alert('Please fill in all fields.');
                    return;
                }

                // Check if course is valid
                const validCourses = ['btech', 'bca', 'bba'];
                if (!validCourses.includes(projectCourse)) {
                    alert('Invalid course selected.');
                    return;
                }

                // Check if studentID already exists
                const duplicate = projectsData.some(p => p.studentID === studentID);
                if (duplicate) {
                    alert('Student ID already exists.');
                    return;
                }

                // Create new project object
                const newProject = {
                    studentID,
                    universityID,
                    name,
                    course: projectCourse,
                    projectTitle,
                    projectLink,
                    workingCode,
                    isLocal: true // Flag to indicate it's from Local Storage
                };

                // Add to projectsData
                projectsData.push(newProject);

                // Save to Local Storage
                saveLocalProjects();

                // Update Course Section Table
                const targetSection = document.querySelector('.course-section[data-course="' + projectCourse + '"]');
                if (targetSection) {
                    const tbody = targetSection.querySelector('tbody');
                    const row = document.createElement('tr');

                    row.innerHTML = `
                        <td>${studentID}</td>
                        <td>${universityID}</td>
                        <td><a href="#" class="student-name">${name}</a></td>
                        <td>${projectTitle}</td>
                        <td><a href="${projectLink}" target="_blank">Project Link</a></td>
                        <td><a href="${workingCode}" target="_blank">Live Demo</a></td>
                    `;

                    tbody.appendChild(row);

                    // Initialize modal for the new student name link
                    initializeModal(targetSection);
                }

                // Update Admin Panel Table if current course is selected
                if (adminCourseDropdown.value === projectCourse) {
                    const tbody = adminProjectTable;
                    const row = document.createElement('tr');

                    row.innerHTML = `
                        <td>${studentID}</td>
                        <td>${universityID}</td>
                        <td>${name}</td>
                        <td>${projectTitle}</td>
                        <td><a href="${projectLink}" target="_blank">Project Link</a></td>
                        <td><a href="${workingCode}" target="_blank">Live Demo</a></td>
                        <td>
                            <button class="edit-button">Edit</button>
                            <button class="delete-button">Delete</button>
                        </td>
                    `;

                    tbody.appendChild(row);
                }

                // Close modal and reset form
                addProjectModal.style.display = 'none';
                addProjectModal.setAttribute('aria-hidden', 'true');
                addProjectForm.reset();

                alert('Project added successfully!');
            });

            // Delegate Edit and Delete button clicks to the Admin Project Table
            adminProjectTable.addEventListener('click', function(event) {
                if (event.target.classList.contains('edit-button')) {
                    const row = event.target.closest('tr');
                    const selectedCourse = adminCourseDropdown.value;
                    const section = document.querySelector('.course-section[data-course="' + selectedCourse + '"]');
                    editProject(row, section);
                }

                if (event.target.classList.contains('delete-button')) {
                    const row = event.target.closest('tr');
                    const selectedCourse = adminCourseDropdown.value;
                    const section = document.querySelector('.course-section[data-course="' + selectedCourse + '"]');
                    deleteProject(row, section);
                }
            });

            // Function to Edit a Project Entry
            function editProject(row, section) {
                const cells = row.getElementsByTagName('td');
                const studentID = cells[0].textContent.trim();
                const universityID = cells[1].textContent.trim();
                const name = cells[2].textContent.trim();
                const projectTitle = cells[3].textContent.trim();
                const projectLink = cells[4].querySelector('a').href;
                const workingCode = cells[5].querySelector('a').href;

                // Populate Add Project Modal with existing data
                addProjectModal.style.display = 'block';
                addProjectModal.setAttribute('aria-hidden', 'false');
                document.getElementById('projectCourse').value = section.getAttribute('data-course');
                document.getElementById('projectStudentID').value = studentID;
                document.getElementById('projectUniversityID').value = universityID;
                document.getElementById('projectName').value = name;
                document.getElementById('projectTitle').value = projectTitle;
                document.getElementById('projectLink').value = projectLink;
                document.getElementById('workingCode').value = workingCode;

                // Change form submission to update existing entry
                addProjectForm.removeEventListener('submit', addProjectHandler);
                addProjectForm.addEventListener('submit', updateProjectHandler);

                function updateProjectHandler(event) {
                    event.preventDefault();

                    // Get updated data
                    const updatedCourse = document.getElementById('projectCourse').value.trim().toLowerCase();
                    const updatedStudentID = document.getElementById('projectStudentID').value.trim();
                    const updatedUniversityID = document.getElementById('projectUniversityID').value.trim();
                    const updatedName = document.getElementById('projectName').value.trim();
                    const updatedProjectTitle = document.getElementById('projectTitle').value.trim();
                    const updatedProjectLink = document.getElementById('projectLink').value.trim();
                    const updatedWorkingCode = document.getElementById('workingCode').value.trim();

                    // Validation
                    if (!updatedCourse || !updatedStudentID || !updatedUniversityID || !updatedName || !updatedProjectTitle || !updatedProjectLink || !updatedWorkingCode) {
                        alert('Please fill in all fields.');
                        return;
                    }

                    // Check if updatedStudentID is unique or same as before
                    if (updatedStudentID !== studentID) {
                        const duplicate = projectsData.some(p => p.studentID === updatedStudentID);
                        if (duplicate) {
                            alert('Updated Student ID already exists.');
                            return;
                        }
                    }

                    // Find project in projectsData
                    const projectIndex = projectsData.findIndex(p => p.studentID === studentID && p.isLocal);
                    if (projectIndex === -1) {
                        alert('Project not found.');
                        return;
                    }

                    // Update project data
                    projectsData[projectIndex] = {
                        studentID: updatedStudentID,
                        universityID: updatedUniversityID,
                        name: updatedName,
                        course: updatedCourse,
                        projectTitle: updatedProjectTitle,
                        projectLink: updatedProjectLink,
                        workingCode: updatedWorkingCode,
                        isLocal: true
                    };

                    // Save to Local Storage
                    saveLocalProjects();

                    // Update Admin Table
                    cells[0].textContent = updatedStudentID;
                    cells[1].textContent = updatedUniversityID;
                    cells[2].textContent = updatedName;
                    cells[3].textContent = updatedProjectTitle;
                    cells[4].innerHTML = `<a href="${updatedProjectLink}" target="_blank">Project Link</a>`;
                    cells[5].innerHTML = `<a href="${updatedWorkingCode}" target="_blank">Live Demo</a>`;

                    // Update Course Section Table
                    const mainTbody = section.querySelector('tbody');
                    const mainRows = mainTbody.getElementsByTagName('tr');
                    for (let i = 0; i < mainRows.length; i++) {
                        if (mainRows[i].cells[0].textContent.trim() === studentID) {
                            mainRows[i].innerHTML = `
                                <td>${updatedStudentID}</td>
                                <td>${updatedUniversityID}</td>
                                <td><a href="#" class="student-name">${updatedName}</a></td>
                                <td>${updatedProjectTitle}</td>
                                <td><a href="${updatedProjectLink}" target="_blank">Project Link</a></td>
                                <td><a href="${updatedWorkingCode}" target="_blank">Live Demo</a></td>
                            `;
                            break;
                        }
                    }

                    // Re-initialize modal for updated student name link
                    initializeModal(section);

                    // Close modal and reset form
                    addProjectModal.style.display = 'none';
                    addProjectModal.setAttribute('aria-hidden', 'true');
                    addProjectForm.reset();

                    // Restore form submission handler
                    addProjectForm.removeEventListener('submit', updateProjectHandler);
                }
            }

            // Function to Delete a Project Entry
            function deleteProject(row, section) {
                const cells = row.getElementsByTagName('td');
                const studentID = cells[0].textContent.trim();

                if (confirm('Are you sure you want to delete this project?')) {
                    // Remove from projectsData
                    projectsData = projectsData.filter(p => !(p.studentID === studentID && p.isLocal));

                    // Save to Local Storage
                    saveLocalProjects();

                    // Remove from Admin Table
                    row.parentNode.removeChild(row);

                    // Remove from Course Section Table
                    const mainTbody = section.querySelector('tbody');
                    const mainRows = mainTbody.getElementsByTagName('tr');
                    for (let i = 0; i < mainRows.length; i++) {
                        if (mainRows[i].cells[0].textContent.trim() === studentID) {
                            mainRows[i].parentNode.removeChild(mainRows[i]);
                            break;
                        }
                    }

                    alert('Project deleted successfully!');
                }
            }

            // Initialize Admin Course Dropdown Listener
            adminCourseDropdown.addEventListener('change', function() {
                const selectedCourse = this.value.trim().toLowerCase();
                currentCourse = selectedCourse;

                populateAdminTable(selectedCourse);
            });

            // Function to Populate Admin Table
            function populateAdminTable(course) {
                const filteredProjects = projectsData.filter(p => p.course === course);

                // Clear existing rows
                adminProjectTable.innerHTML = '';

                filteredProjects.forEach(project => {
                    const row = document.createElement('tr');

                    row.innerHTML = `
                        <td>${project.studentID}</td>
                        <td>${project.universityID}</td>
                        <td>${project.name}</td>
                        <td>${project.projectTitle}</td>
                        <td><a href="${project.projectLink}" target="_blank">Project Link</a></td>
                        <td><a href="${project.workingCode}" target="_blank">Live Demo</a></td>
                        <td>
                            <button class="edit-button">Edit</button>
                            <button class="delete-button">Delete</button>
                        </td>
                    `;

                    adminProjectTable.appendChild(row);
                });
            }

            // Smooth scrolling for navigation links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth'
                        });
                    }
                });
            });

            // Initialize Projects on Page Load
            loadProjects();
        });
    </script>

</body>
</html>
